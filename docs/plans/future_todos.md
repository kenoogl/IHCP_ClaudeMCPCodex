# 今後のTODOリスト

**作成日**: 2025-10-01
**プロジェクト**: 逆熱伝導問題（IHCP）CGMソルバー Julia移植
**現状**: Phase 1-5完了（100%達成）

---

## 📊 当初計画との比較

### 達成済み項目（Phase 1-5）

| Phase | 当初計画 | 実績 | 達成率 |
|-------|---------|------|--------|
| Phase 1 | 熱物性値計算・ユーティリティ | 熱物性値計算・データローダー | ✅ 100% |
| Phase 2 | DHCP直接ソルバー | DHCP陰解法ソルバー | ✅ 100% |
| Phase 3 | Adjoint随伴ソルバー | Adjoint随伴ソルバー | ✅ 100% |
| Phase 4 | CGM最適化 | CGM最適化 | ✅ 100% |
| Phase 5 | スライディングウィンドウ | スライディングウィンドウ | ✅ 100% |

### 未実装項目（当初計画に含まれていた機能）

#### Phase 1の未実装機能
1. **検証器関数群**（当初計画: 4関数）
   - `check_field_finite()` → 未実装
   - `check_temperature_range()` → 未実装
   - `check_flux_range()` → 未実装
   - `check_gradient_magnitude()` → 未実装

2. **MATファイル読込機能**（当初計画: 2関数）
   - `extract_sorted_mat_files()` → 未実装
   - `load_region_temperature()` → 未実装

3. **メモリ監視機能**（当初計画: 2関数）
   - `get_memory_info()` → 未実装
   - `safe_load_large_data()` → 未実装

#### その他の未実装機能
4. **結果保存機能**
   - NPZ形式保存（Python互換）
   - JLD2形式保存（Julia推奨）

5. **メインエントリポイント**
   - コマンドライン引数処理
   - 設定ファイル読込

6. **性能測定・ベンチマーク**
   - Python版との速度比較
   - メモリ使用量測定
   - 並列化効果検証

---

## 🎯 優先度別TODOリスト

### カテゴリA: 基本機能完成（優先度: 高）

#### A-1. 検証器関数群の実装
**目的**: 数値計算の健全性チェック
**対象ファイル**: `julia/src/utils/validators.jl`

- [ ] `check_field_finite(field)` - 有限値チェック（NaN/Inf検出）
- [ ] `check_temperature_range(T, Tmin, Tmax)` - 温度範囲検証
- [ ] `check_flux_range(q, qmin, qmax)` - 熱流束範囲検証
- [ ] `check_gradient_magnitude(∇T, threshold)` - 勾配急変検出

**成功基準**:
- Python原典（1100-1260行）との動作一致
- CGMソルバー内で警告機能として動作
- テストカバレッジ > 90%

**工数**: 2-3日

---

#### A-2. 結果保存機能の実装
**目的**: 計算結果の永続化
**対象ファイル**: `julia/src/utils/io.jl`

- [ ] `save_results_npz(filename, q, T, metadata)` - NPZ形式保存（Python互換）
- [ ] `save_results_jld2(filename, q, T, metadata)` - JLD2形式保存（Julia推奨）
- [ ] `load_results(filename)` - 結果読込（自動フォーマット判定）

**成功基準**:
- Python `numpy.load()` で読込可能
- メタデータ（格子情報、パラメータ）も保存
- ファイルサイズ最適化

**工数**: 1-2日

---

#### A-3. メインエントリポイントの実装
**目的**: スタンドアロン実行可能な実用ツール化
**対象ファイル**: `julia/src/main.jl`

- [ ] コマンドライン引数処理（`ArgParse.jl`）
- [ ] 設定ファイル読込（TOML形式推奨）
- [ ] 実行モード選択（full/test/benchmark）
- [ ] プログレスバー表示（`ProgressMeter.jl`）
- [ ] ログ出力（`Logging.jl`）

**成功基準**:
```bash
julia --project=. src/main.jl --config config.toml --output results.jld2
```
で全時間領域計算が実行できる

**工数**: 3-5日

---

### カテゴリB: 性能最適化（優先度: 中）

#### B-1. Python版との性能ベンチマーク
**目的**: Julia移植の速度向上効果の定量化
**対象ファイル**: `julia/benchmarks/compare_with_python.jl`

- [ ] 同一問題設定でPython/Julia実行時間測定
- [ ] Phase別の速度比較（DHCP/Adjoint/CGM）
- [ ] メモリ使用量比較
- [ ] 結果レポート自動生成

**成功基準**:
- 総合速度: Julia ≥ 5倍高速（当初目標）
- メモリ: Python同等以下
- ドキュメント化

**工数**: 2-3日

---

#### B-2. 並列化最適化
**目的**: マルチコア環境での性能向上
**対象ファイル**: 各ソルバー

- [ ] DHCP係数構築の並列化（`Threads.@threads`）
- [ ] Adjoint係数構築の並列化
- [ ] 空間方向ループの並列化検証
- [ ] スケーラビリティ測定（1/2/4/8コア）

**成功基準**:
- 4コアで2倍以上の速度向上
- 並列化オーバーヘッド < 10%
- `JULIA_NUM_THREADS=4` で動作確認

**工数**: 3-5日

---

#### B-3. GPU対応（探索的）
**目的**: 超大規模問題への対応
**対象ファイル**: `julia/src/gpu/`（新規）

- [ ] `CUDA.jl`による疎行列CG法のGPU実装
- [ ] 係数構築のGPUカーネル化
- [ ] CPU-GPU転送コスト測定
- [ ] 有効性評価

**成功基準**:
- 大規模問題（ni×nj×nk > 100万）で10倍以上高速化
- メモリ制限内での動作確認

**工数**: 1-2週間（探索的）

---

### カテゴリC: 実データ検証（優先度: 高）

#### C-1. IRカメラデータでの動作確認
**目的**: 実験データでの妥当性検証
**対象ファイル**: `julia/examples/real_data_example.jl`

- [ ] MATファイル読込機能の実装
  - `extract_sorted_mat_files()` - ファイル名ソート
  - `load_region_temperature()` - 温度データ抽出
- [ ] `T_measure_700um_1ms.npy`（1.1GB）読込テスト
- [ ] フルスケール計算実行
- [ ] Python版結果との比較

**成功基準**:
- 実データが正常読込可能
- 計算が完走（数時間～）
- 結果がPython版と定性的に一致

**工数**: 3-5日

---

#### C-2. 大規模問題での安定性検証
**目的**: 長時間・大空間格子での動作確認

- [ ] nt=10000以上の長時間計算
- [ ] ni×nj×nk > 10万の大規模格子
- [ ] メモリリーク検証
- [ ] 数値不安定性の検出

**成功基準**:
- 8GB以内のメモリで完走
- 計算途中での異常終了なし
- 警告・エラーログの分析

**工数**: 2-3日

---

### カテゴリD: ドキュメント整備（優先度: 中）

#### D-1. API仕様書の作成
**目的**: ユーザー・開発者向けドキュメント

- [ ] `Documenter.jl`による自動ドキュメント生成
- [ ] 各関数のdocstring整備
- [ ] 使用例の追加
- [ ] GitHub Pagesへのデプロイ

**成功基準**:
- 全公開関数にdocstring
- 実行可能な使用例 ≥ 5個
- オンラインドキュメント公開

**工数**: 3-5日

---

#### D-2. README・チュートリアルの充実

- [ ] `julia/README.md`の詳細化
  - インストール手順
  - クイックスタート
  - トラブルシューティング
- [ ] Jupyter Notebookチュートリアル作成
  - Phase 1-5の段階的実行例
  - 可視化コード（`Plots.jl`）
- [ ] 日本語・英語版の整備

**成功基準**:
- 初心者が30分で基本動作確認可能
- ノートブック実行可能

**工数**: 2-3日

---

#### D-3. 論文・技術レポート作成

- [ ] 移植方針・技術選択の文書化
- [ ] 性能ベンチマーク結果のまとめ
- [ ] TDD方針の効果検証
- [ ] Codex MCP連携のケーススタディ

**成功基準**:
- 技術レポート（10-20ページ）
- 学会発表資料（オプション）

**工数**: 1-2週間

---

### カテゴリE: 拡張機能（優先度: 低）

#### E-1. 可視化機能

- [ ] 温度場・熱流束のアニメーション（`Plots.jl`/`Makie.jl`）
- [ ] CGM収束履歴のプロット
- [ ] ウィンドウ分割の可視化
- [ ] インタラクティブプロット（`PlotlyJS.jl`）

**工数**: 3-5日

---

#### E-2. パラメータスタディ機能

- [ ] グリッドサーチ（ウィンドウサイズ、オーバーラップ）
- [ ] 感度解析（観測ノイズσ）
- [ ] 多条件一括実行
- [ ] 結果比較レポート自動生成

**工数**: 5-7日

---

#### E-3. Webインターフェース（探索的）

- [ ] `Genie.jl`によるWebアプリ化
- [ ] パラメータ入力UI
- [ ] 結果可視化ダッシュボード
- [ ] クラウドデプロイ

**工数**: 2-3週間

---

## 📅 推奨実施スケジュール

### フェーズ6: 基本機能完成（Week 1-2）
- A-1: 検証器関数群（2日）
- A-2: 結果保存機能（2日）
- A-3: メインエントリポイント（4日）
- C-1: 実データ読込（3日）

**成果物**: スタンドアロン実行可能な実用ツール

---

### フェーズ7: 性能検証（Week 3-4）
- B-1: Python版ベンチマーク（3日）
- B-2: 並列化最適化（4日）
- C-2: 大規模問題検証（3日）

**成果物**: 性能レポート、最適化版コード

---

### フェーズ8: ドキュメント整備（Week 5-6）
- D-1: API仕様書（4日）
- D-2: README・チュートリアル（3日）
- D-3: 技術レポート（7日）

**成果物**: 完全なドキュメントセット

---

### フェーズ9: 拡張機能（Week 7-8、オプション）
- E-1: 可視化機能（4日）
- E-2: パラメータスタディ（6日）

**成果物**: 研究支援ツール

---

## 🎯 重要度マトリクス

| カテゴリ | 項目 | 重要度 | 緊急度 | 推奨着手順 |
|---------|------|--------|--------|-----------|
| A-3 | メインエントリポイント | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 1位 |
| C-1 | 実データ検証 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 2位 |
| A-2 | 結果保存機能 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 3位 |
| B-1 | 性能ベンチマーク | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 4位 |
| A-1 | 検証器関数群 | ⭐⭐⭐ | ⭐⭐⭐ | 5位 |
| C-2 | 大規模問題検証 | ⭐⭐⭐⭐ | ⭐⭐⭐ | 6位 |
| B-2 | 並列化最適化 | ⭐⭐⭐ | ⭐⭐⭐ | 7位 |
| D-1 | API仕様書 | ⭐⭐⭐ | ⭐⭐ | 8位 |
| D-2 | README・チュートリアル | ⭐⭐⭐ | ⭐⭐ | 9位 |
| E-1 | 可視化機能 | ⭐⭐ | ⭐ | 10位 |
| D-3 | 技術レポート | ⭐⭐ | ⭐ | 11位 |
| B-3 | GPU対応 | ⭐ | ⭐ | 12位（探索的）|
| E-2 | パラメータスタディ | ⭐ | ⭐ | 13位 |
| E-3 | Webインターフェース | ⭐ | ⭐ | 14位（探索的）|

---

## 📋 次のアクションアイテム

### 即座に実施可能な項目（今日～明日）

1. **A-3の一部: コマンドライン引数処理**
   ```bash
   julia --project=. src/main.jl --help
   ```
   - `ArgParse.jl`のセットアップ
   - 基本的な引数定義

2. **A-2の一部: JLD2保存機能**
   ```julia
   using JLD2
   save_results("results.jld2", q_global, windows_info)
   ```
   - 最小限の保存機能実装

3. **C-1の準備: MATファイル調査**
   - `MAT.jl`のインストール
   - サンプルMATファイルの読込テスト

---

## 🔄 Codex MCP連携推奨事項

今後の実装でもCodex MCPを活用:

### 連携が有効なタスク
- ✅ A-1（検証器関数群）: Python原典との詳細比較
- ✅ C-1（実データ読込）: MATファイル構造解析
- ✅ B-1（性能ベンチマーク）: 測定コード実装
- ✅ D-1（API仕様書）: docstring自動生成支援

### 連携の進め方
1. **分析フェーズ**: Codexにコード調査を依頼
2. **設計フェーズ**: Claude Codeが設計レビュー
3. **実装フェーズ**: ペアで進行
4. **検証フェーズ**: Codexがテスト実行

---

## 📝 まとめ

### 現状
- **Phase 1-5**: 100%完了（383テスト全合格）
- **コア機能**: 完全動作
- **Python互換性**: 数値完全一致達成

### 次のマイルストーン
- **フェーズ6完了**: 実用ツール化（2週間）
- **フェーズ7完了**: 性能検証完了（4週間）
- **フェーズ8完了**: ドキュメント完備（6週間）

### 最終ゴール
**実験データで動作する、高性能・高信頼性のJulia版IHCPソルバー**

---

**作成日**: 2025-10-01
**作成者**: Claude Code
**レビュー**: 未実施
